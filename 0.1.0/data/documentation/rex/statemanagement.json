{"kind":"article","sections":[],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/rex\/statemanagement"]}],"metadata":{"modules":[{"name":"Rex"}],"role":"article","roleHeading":"Article","title":"State Management"},"abstract":[{"type":"text","text":"Learn how to effectively manage application state with Swift-Rex."}],"hierarchy":{"paths":[["doc:\/\/Rex\/documentation\/Rex"]]},"primaryContentSections":[{"content":[{"anchor":"Overview","level":2,"type":"heading","text":"Overview"},{"inlineContent":[{"type":"text","text":"State management is the core of any Swift-Rex application. Understanding how to structure and manage your state effectively is crucial for building maintainable and scalable applications."}],"type":"paragraph"},{"anchor":"State-Structure","level":2,"type":"heading","text":"State Structure"},{"anchor":"Single-State-Tree","level":3,"type":"heading","text":"Single State Tree"},{"inlineContent":[{"type":"text","text":"Swift-Rex uses a single state tree that represents the entire state of your application. This makes it easy to track changes and debug issues."}],"type":"paragraph"},{"syntax":"swift","code":["struct AppState: StateType {","    \/\/ User state","    var user: User?","    var isAuthenticated: Bool = false","","    \/\/ UI state","    var isLoading: Bool = false","    var errorMessage: String? = nil","","    \/\/ Feature state","    var counter: CounterState = CounterState()","    var todo: TodoState = TodoState()","    var settings: SettingsState = SettingsState()","","    \/\/ App state","    var lastUpdated: Date = Date()","}"],"type":"codeListing"},{"anchor":"Nested-State","level":3,"type":"heading","text":"Nested State"},{"inlineContent":[{"text":"Break down your state into smaller, focused pieces:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["struct CounterState {","    var count: Int = 0","    var history: [Int] = []","}","","struct TodoState {","    var todos: [Todo] = []","    var filter: TodoFilter = .all","    var isLoading: Bool = false","}","","struct SettingsState {","    var theme: Theme = .light","    var notifications: Bool = true","    var language: Language = .english","}"],"type":"codeListing"},{"anchor":"State-Updates","level":2,"type":"heading","text":"State Updates"},{"anchor":"Immutable-Updates","level":3,"type":"heading","text":"Immutable Updates"},{"inlineContent":[{"type":"text","text":"Always create new state rather than modifying existing state:"}],"type":"paragraph"},{"type":"codeListing","code":["\/\/ ❌ Wrong - Direct mutation","state.count += 1","","\/\/ ✅ Correct - Create new state","state.count = state.count + 1"],"syntax":"swift"},{"anchor":"Batch-Updates","type":"heading","level":3,"text":"Batch Updates"},{"inlineContent":[{"type":"text","text":"When updating multiple properties, do it in a single action:"}],"type":"paragraph"},{"type":"codeListing","code":["case .userLoggedIn(let user):","    state.user = user","    state.isAuthenticated = true","    state.errorMessage = nil","    state.lastUpdated = Date()","    return [.none]"],"syntax":"swift"},{"anchor":"State-Normalization","type":"heading","level":2,"text":"State Normalization"},{"anchor":"Normalized-Data","type":"heading","level":3,"text":"Normalized Data"},{"inlineContent":[{"type":"text","text":"Store related data in a normalized structure for better performance:"}],"type":"paragraph"},{"type":"codeListing","code":["struct AppState: StateType {","    \/\/ Normalized entities","    var users: [String: User] = [:]","    var posts: [String: Post] = [:]","    var comments: [String: Comment] = [:]","","    \/\/ References","    var currentUserId: String?","    var selectedPostId: String?","","    \/\/ UI state","    var isLoading: Bool = false","    var errorMessage: String? = nil","}"],"syntax":"swift"},{"anchor":"Benefits-of-Normalization","type":"heading","level":3,"text":"Benefits of Normalization"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"text":"Performance","type":"text"}]},{"text":": Faster lookups and updates","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"Consistency"}],"type":"strong"},{"text":": Single source of truth for each entity","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Memory"}]},{"type":"text","text":": Reduced memory usage"}]}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Updates","type":"text"}]},{"type":"text","text":": Easier to update related data"}],"type":"paragraph"}]}]},{"anchor":"State-Composition","type":"heading","level":2,"text":"State Composition"},{"anchor":"Combining-Reducers","type":"heading","level":3,"text":"Combining Reducers"},{"inlineContent":[{"text":"Split your reducer into smaller, focused reducers:","type":"text"}],"type":"paragraph"},{"type":"codeListing","code":["struct AppReducer: Reducer {","    func reduce(state: inout AppState, action: AppAction) -> [Effect<AppAction>] {","        switch action {","        case let .counter(action):","            return counterReducer.reduce(state: &state.counter, action: action)","","        case let .todo(action):","            return todoReducer.reduce(state: &state.todo, action: action)","","        case let .settings(action):","            return settingsReducer.reduce(state: &state.settings, action: action)","","        case .userLoggedIn(let user):","            state.user = user","            state.isAuthenticated = true","            return [.none]","        }","    }","}"],"syntax":"swift"},{"anchor":"Action-Composition","type":"heading","level":3,"text":"Action Composition"},{"inlineContent":[{"type":"text","text":"Use associated values to compose actions:"}],"type":"paragraph"},{"type":"codeListing","code":["enum AppAction: ActionType {","    case counter(CounterAction)","    case todo(TodoAction)","    case settings(SettingsAction)","    case user(UserAction)","}","","enum CounterAction: ActionType {","    case increment","    case decrement","    case reset","}","","enum TodoAction: ActionType {","    case add(String)","    case remove(String)","    case toggle(String)","    case setFilter(TodoFilter)","}"],"syntax":"swift"},{"anchor":"State-Persistence","type":"heading","level":2,"text":"State Persistence"},{"anchor":"Saving-State","type":"heading","level":3,"text":"Saving State"},{"inlineContent":[{"text":"Persist important state to disk:","type":"text"}],"type":"paragraph"},{"type":"codeListing","code":["struct AppReducer: Reducer {","    func reduce(state: inout AppState, action: AppAction) -> [Effect<AppAction>] {","        switch action {","        case .userLoggedIn(let user):","            state.user = user","            state.isAuthenticated = true","            return [","                Effect { emitter in","                    \/\/ Save user to disk","                    try await UserDefaults.standard.setValue(","                        user.id,","                        forKey: \"currentUserId\"","                    )","                    await emitter.send(.userSaved)","                }","            ]","        }","    }","}"],"syntax":"swift"},{"anchor":"Loading-State","type":"heading","level":3,"text":"Loading State"},{"inlineContent":[{"text":"Load persisted state on app launch:","type":"text"}],"type":"paragraph"},{"type":"codeListing","code":["struct AppReducer: Reducer {","    func reduce(state: inout AppState, action: AppAction) -> [Effect<AppAction>] {","        switch action {","        case .loadPersistedState:","            return [","                Effect { emitter in","                    if let userId = UserDefaults.standard.string(forKey: \"currentUserId\") {","                        let user = try await UserService.fetchUser(id: userId)","                        await emitter.send(.userLoaded(user))","                    }","                }","            ]","        }","    }","}"],"syntax":"swift"},{"text":"State Validation","anchor":"State-Validation","level":2,"type":"heading"},{"text":"Input Validation","anchor":"Input-Validation","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"Validate state changes in your reducer:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["case .setCount(let count):","    guard count >= 0 else {","        state.errorMessage = \"Count cannot be negative\"","        return [.none]","    }","    state.count = count","    state.lastUpdated = Date()","    return [.none]"]},{"text":"State Constraints","anchor":"State-Constraints","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"Enforce business rules in your state:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["struct AppState: StateType {","    var count: Int = 0 {","        didSet {","            \/\/ Ensure count never goes below 0","            if count < 0 {","                count = 0","            }","        }","    }","}"]},{"text":"Performance Optimization","anchor":"Performance-Optimization","level":2,"type":"heading"},{"text":"Selective Updates","anchor":"Selective-Updates","level":3,"type":"heading"},{"inlineContent":[{"text":"Only update what has changed:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["case .updateUserProfile(let profile):","    \/\/ Only update if profile actually changed","    if state.user?.profile != profile {","        state.user?.profile = profile","        state.lastUpdated = Date()","    }","    return [.none]"]},{"text":"Computed Properties","anchor":"Computed-Properties","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"Use computed properties for derived state:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["extension AppState {","    var completedTodos: [Todo] {","        todos.filter { $0.isCompleted }","    }","","    var incompleteTodos: [Todo] {","        todos.filter { !$0.isCompleted }","    }","","    var todoCount: Int {","        todos.count","    }","}"]},{"text":"Best Practices","anchor":"Best-Practices","level":2,"type":"heading"},{"text":"1. Keep State Minimal","anchor":"1-Keep-State-Minimal","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"Only store what you need:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["\/\/ ❌ Don't store derived data","struct AppState {","    var todos: [Todo] = []","    var completedTodos: [Todo] = [] \/\/ Redundant","}","","\/\/ ✅ Store only source data","struct AppState {","    var todos: [Todo] = []","}"]},{"text":"2. Use Descriptive Names","anchor":"2-Use-Descriptive-Names","level":3,"type":"heading"},{"inlineContent":[{"text":"Make your state properties self-documenting:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["\/\/ ❌ Unclear","var flag: Bool = false","","\/\/ ✅ Clear","var isUserLoggedIn: Bool = false"]},{"text":"3. Group Related State","anchor":"3-Group-Related-State","level":3,"type":"heading"},{"inlineContent":[{"text":"Keep related properties together:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["struct AppState {","    \/\/ Authentication","    var user: User?","    var isAuthenticated: Bool = false","    var authToken: String?","","    \/\/ UI State","    var isLoading: Bool = false","    var errorMessage: String? = nil","    var currentTab: Tab = .home","","    \/\/ Feature State","    var counter: CounterState = CounterState()","    var todo: TodoState = TodoState()","}"]},{"text":"4. Handle Loading States","anchor":"4-Handle-Loading-States","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"Always track loading states for async operations:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["case .loadUser:","    state.isLoading = true","    state.errorMessage = nil","    return [","        Effect { emitter in","            let user = try await UserService.fetchUser()","            await emitter.send(.userLoaded(user))","        }","    ]"]},{"text":"5. Error Handling","anchor":"5-Error-Handling","level":3,"type":"heading"},{"inlineContent":[{"text":"Provide meaningful error messages:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["case .loadUserFailed(let error):","    state.isLoading = false","    state.errorMessage = \"Failed to load user: \\(error.localizedDescription)\"","    return [.none]"]},{"text":"Next Steps","anchor":"Next-Steps","level":2,"type":"heading"},{"inlineContent":[{"text":"Now that you understand state management, explore:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"identifier":"doc:\/\/Rex\/documentation\/Rex\/Store","type":"reference","isActive":true},{"text":" - Learn about the Store implementation","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"identifier":"doc:\/\/Rex\/documentation\/Rex\/Reducer","isActive":true,"type":"reference"},{"text":" - Understand Reducer patterns","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"identifier":"doc:\/\/Rex\/documentation\/Rex\/Effect","type":"reference","isActive":true},{"type":"text","text":" - Handle side effects"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"doc:BestPractices"},{"type":"text","text":" - Advanced patterns and tips"}],"type":"paragraph"}]}],"type":"unorderedList"}],"kind":"content"}],"schemaVersion":{"patch":0,"major":0,"minor":3},"identifier":{"url":"doc:\/\/Rex\/documentation\/Rex\/StateManagement","interfaceLanguage":"swift"},"references":{"doc://Rex/documentation/Rex/Effect":{"title":"Effect","role":"symbol","navigatorTitle":[{"text":"Effect","kind":"identifier"}],"type":"topic","abstract":[{"text":"A struct that represents a side effect that can be executed by the store.","type":"text"}],"kind":"symbol","identifier":"doc:\/\/Rex\/documentation\/Rex\/Effect","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"Effect","kind":"identifier"}],"url":"\/documentation\/rex\/effect"},"doc://Rex/documentation/Rex":{"role":"collection","type":"topic","title":"Rex","abstract":[],"kind":"symbol","identifier":"doc:\/\/Rex\/documentation\/Rex","url":"\/documentation\/rex"},"doc://Rex/documentation/Rex/Reducer":{"fragments":[{"text":"protocol","kind":"keyword"},{"text":" ","kind":"text"},{"text":"Reducer","kind":"identifier"}],"url":"\/documentation\/rex\/reducer","navigatorTitle":[{"text":"Reducer","kind":"identifier"}],"kind":"symbol","title":"Reducer","identifier":"doc:\/\/Rex\/documentation\/Rex\/Reducer","type":"topic","abstract":[{"text":"A protocol that defines the core logic for transforming state based on actions.","type":"text"}],"role":"symbol"},"doc://Rex/documentation/Rex/Store":{"fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"Store"}],"abstract":[],"role":"symbol","kind":"symbol","url":"\/documentation\/rex\/store","navigatorTitle":[{"kind":"identifier","text":"Store"}],"title":"Store","type":"topic","identifier":"doc:\/\/Rex\/documentation\/Rex\/Store"}}}